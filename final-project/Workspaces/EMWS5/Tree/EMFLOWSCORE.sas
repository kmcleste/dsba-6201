****************************************************************;
******             DECISION TREE SCORING CODE             ******;
****************************************************************;
 
******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
LENGTH F_TargetBuy  $   12;
LENGTH I_TargetBuy  $   12;
LENGTH _WARN_  $    4;
 
******              LABELS FOR NEW VARIABLES              ******;
label _NODE_ = 'Node' ;
label _LEAF_ = 'Leaf' ;
label P_TargetBuy0 = 'Predicted: TargetBuy=0' ;
label P_TargetBuy1 = 'Predicted: TargetBuy=1' ;
label Q_TargetBuy0 = 'Unadjusted P: TargetBuy=0' ;
label Q_TargetBuy1 = 'Unadjusted P: TargetBuy=1' ;
label V_TargetBuy0 = 'Validated: TargetBuy=0' ;
label V_TargetBuy1 = 'Validated: TargetBuy=1' ;
label R_TargetBuy0 = 'Residual: TargetBuy=0' ;
label R_TargetBuy1 = 'Residual: TargetBuy=1' ;
label F_TargetBuy = 'From: TargetBuy' ;
label I_TargetBuy = 'Into: TargetBuy' ;
label U_TargetBuy = 'Unnormalized Into: TargetBuy' ;
label _WARN_ = 'Warnings' ;
 
 
******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12;
_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1;
_ARBFMT_1 = ' '; /* Initialize to avoid warning. */
 
 
_ARBFMT_12 = PUT( TargetBuy , BEST12.);
 %DMNORMCP( _ARBFMT_12, F_TargetBuy );
 
******             ASSIGN OBSERVATION TO NODE             ******;
IF  NOT MISSING(DemAge ) AND
  DemAge  <                 44.5 THEN DO;
  IF  NOT MISSING(DemAffl ) AND
    DemAffl  <                  9.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      IF  NOT MISSING(DemAffl ) AND
        DemAffl  <                  6.5 THEN DO;
        _NODE_  =                   18;
        _LEAF_  =                    2;
        P_TargetBuy0  =      0.6383495145631;
        P_TargetBuy1  =     0.36165048543689;
        Q_TargetBuy0  =      0.6383495145631;
        Q_TargetBuy1  =     0.36165048543689;
        V_TargetBuy0  =     0.60089686098654;
        V_TargetBuy1  =     0.39910313901345;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      ELSE DO;
        IF  NOT MISSING(DemAge ) AND
                          39.5 <= DemAge  THEN DO;
          _NODE_  =                   35;
          _LEAF_  =                    4;
          P_TargetBuy0  =     0.56326530612244;
          P_TargetBuy1  =     0.43673469387755;
          Q_TargetBuy0  =     0.56326530612244;
          Q_TargetBuy1  =     0.43673469387755;
          V_TargetBuy0  =     0.58273381294964;
          V_TargetBuy1  =     0.41726618705035;
          I_TargetBuy  = '0' ;
          U_TargetBuy  =                    0;
          END;
        ELSE DO;
          _NODE_  =                   34;
          _LEAF_  =                    3;
          P_TargetBuy0  =     0.39285714285714;
          P_TargetBuy1  =     0.60714285714285;
          Q_TargetBuy0  =     0.39285714285714;
          Q_TargetBuy1  =     0.60714285714285;
          V_TargetBuy0  =     0.36507936507936;
          V_TargetBuy1  =     0.63492063492063;
          I_TargetBuy  = '1' ;
          U_TargetBuy  =                    1;
          END;
        END;
      END;
    ELSE DO;
      _NODE_  =                    8;
      _LEAF_  =                    1;
      P_TargetBuy0  =     0.77363515312916;
      P_TargetBuy1  =     0.22636484687083;
      Q_TargetBuy0  =     0.77363515312916;
      Q_TargetBuy1  =     0.22636484687083;
      V_TargetBuy0  =     0.79864253393665;
      V_TargetBuy1  =     0.20135746606334;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   11;
      _LEAF_  =                    9;
      P_TargetBuy0  =     0.21991341991341;
      P_TargetBuy1  =     0.78008658008658;
      Q_TargetBuy0  =     0.21991341991341;
      Q_TargetBuy1  =     0.78008658008658;
      V_TargetBuy0  =     0.20677966101694;
      V_TargetBuy1  =     0.79322033898305;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE DO;
      IF  NOT MISSING(DemAffl ) AND
                        14.5 <= DemAffl  THEN DO;
        _NODE_  =                   21;
        _LEAF_  =                    8;
        P_TargetBuy0  =     0.14666666666666;
        P_TargetBuy1  =     0.85333333333333;
        Q_TargetBuy0  =     0.14666666666666;
        Q_TargetBuy1  =     0.85333333333333;
        V_TargetBuy0  =     0.15094339622641;
        V_TargetBuy1  =     0.84905660377358;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE DO;
        IF  NOT MISSING(DemAffl ) AND
                          11.5 <= DemAffl  THEN DO;
          _ARBFMT_1 = PUT( DemGender , $1.);
           %DMNORMIP( _ARBFMT_1);
          IF _ARBFMT_1 IN ('M' ) THEN DO;
            _NODE_  =                   51;
            _LEAF_  =                    7;
            P_TargetBuy0  =     0.36521739130434;
            P_TargetBuy1  =     0.63478260869565;
            Q_TargetBuy0  =     0.36521739130434;
            Q_TargetBuy1  =     0.63478260869565;
            V_TargetBuy0  =                 0.45;
            V_TargetBuy1  =                 0.55;
            I_TargetBuy  = '1' ;
            U_TargetBuy  =                    1;
            END;
          ELSE DO;
            _NODE_  =                   50;
            _LEAF_  =                    6;
            P_TargetBuy0  =      0.6590909090909;
            P_TargetBuy1  =     0.34090909090909;
            Q_TargetBuy0  =      0.6590909090909;
            Q_TargetBuy1  =     0.34090909090909;
            V_TargetBuy0  =     0.72222222222222;
            V_TargetBuy1  =     0.27777777777777;
            I_TargetBuy  = '0' ;
            U_TargetBuy  =                    0;
            END;
          END;
        ELSE DO;
          _NODE_  =                   36;
          _LEAF_  =                    5;
          P_TargetBuy0  =      0.6156462585034;
          P_TargetBuy1  =     0.38435374149659;
          Q_TargetBuy0  =      0.6156462585034;
          Q_TargetBuy1  =     0.38435374149659;
          V_TargetBuy0  =      0.6936416184971;
          V_TargetBuy1  =     0.30635838150289;
          I_TargetBuy  = '0' ;
          U_TargetBuy  =                    0;
          END;
        END;
      END;
    END;
  END;
ELSE DO;
  IF  NOT MISSING(DemAffl ) AND
                    12.5 <= DemAffl  THEN DO;
    IF  NOT MISSING(DemAffl ) AND
                      15.5 <= DemAffl  THEN DO;
      IF  NOT MISSING(DemAffl ) AND
                        18.5 <= DemAffl  THEN DO;
        _NODE_  =                   31;
        _LEAF_  =                   14;
        P_TargetBuy0  =     0.06779661016949;
        P_TargetBuy1  =      0.9322033898305;
        Q_TargetBuy0  =     0.06779661016949;
        Q_TargetBuy1  =      0.9322033898305;
        V_TargetBuy0  =     0.15151515151515;
        V_TargetBuy1  =     0.84848484848484;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE DO;
        _ARBFMT_1 = PUT( DemGender , $1.);
         %DMNORMIP( _ARBFMT_1);
        IF _ARBFMT_1 IN ('F' ) THEN DO;
          _NODE_  =                   48;
          _LEAF_  =                   12;
          P_TargetBuy0  =     0.28971962616822;
          P_TargetBuy1  =     0.71028037383177;
          Q_TargetBuy0  =     0.28971962616822;
          Q_TargetBuy1  =     0.71028037383177;
          V_TargetBuy0  =     0.29411764705882;
          V_TargetBuy1  =     0.70588235294117;
          I_TargetBuy  = '1' ;
          U_TargetBuy  =                    1;
          END;
        ELSE DO;
          _NODE_  =                   49;
          _LEAF_  =                   13;
          P_TargetBuy0  =     0.54054054054054;
          P_TargetBuy1  =     0.45945945945945;
          Q_TargetBuy0  =     0.54054054054054;
          Q_TargetBuy1  =     0.45945945945945;
          V_TargetBuy0  =     0.77142857142857;
          V_TargetBuy1  =     0.22857142857142;
          I_TargetBuy  = '0' ;
          U_TargetBuy  =                    0;
          END;
        END;
      END;
    ELSE DO;
      _NODE_  =                   14;
      _LEAF_  =                   11;
      P_TargetBuy0  =     0.63975155279503;
      P_TargetBuy1  =     0.36024844720496;
      Q_TargetBuy0  =     0.63975155279503;
      Q_TargetBuy1  =     0.36024844720496;
      V_TargetBuy0  =     0.58256880733944;
      V_TargetBuy1  =     0.41743119266055;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE DO;
    _NODE_  =                    6;
    _LEAF_  =                   10;
    P_TargetBuy0  =     0.87232532197545;
    P_TargetBuy1  =     0.12767467802454;
    Q_TargetBuy0  =     0.87232532197545;
    Q_TargetBuy1  =     0.12767467802454;
    V_TargetBuy0  =       0.872368670586;
    V_TargetBuy1  =     0.12763132941399;
    I_TargetBuy  = '0' ;
    U_TargetBuy  =                    0;
    END;
  END;
 
*****  RESIDUALS R_ *************;
IF  F_TargetBuy  NE '0'
AND F_TargetBuy  NE '1'  THEN DO;
        R_TargetBuy0  = .;
        R_TargetBuy1  = .;
 END;
 ELSE DO;
       R_TargetBuy0  =  -P_TargetBuy0 ;
       R_TargetBuy1  =  -P_TargetBuy1 ;
       SELECT( F_TargetBuy  );
          WHEN( '0'  ) R_TargetBuy0  = R_TargetBuy0  +1;
          WHEN( '1'  ) R_TargetBuy1  = R_TargetBuy1  +1;
       END;
 END;
 
****************************************************************;
******          END OF DECISION TREE SCORING CODE         ******;
****************************************************************;
 
drop _LEAF_;
