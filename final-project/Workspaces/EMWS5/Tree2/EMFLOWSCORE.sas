****************************************************************;
******             DECISION TREE SCORING CODE             ******;
****************************************************************;
 
******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
LENGTH F_TargetBuy  $   12;
LENGTH I_TargetBuy  $   12;
LENGTH _WARN_  $    4;
 
******              LABELS FOR NEW VARIABLES              ******;
label _NODE_ = 'Node' ;
label _LEAF_ = 'Leaf' ;
label P_TargetBuy0 = 'Predicted: TargetBuy=0' ;
label P_TargetBuy1 = 'Predicted: TargetBuy=1' ;
label Q_TargetBuy0 = 'Unadjusted P: TargetBuy=0' ;
label Q_TargetBuy1 = 'Unadjusted P: TargetBuy=1' ;
label V_TargetBuy0 = 'Validated: TargetBuy=0' ;
label V_TargetBuy1 = 'Validated: TargetBuy=1' ;
label R_TargetBuy0 = 'Residual: TargetBuy=0' ;
label R_TargetBuy1 = 'Residual: TargetBuy=1' ;
label F_TargetBuy = 'From: TargetBuy' ;
label I_TargetBuy = 'Into: TargetBuy' ;
label U_TargetBuy = 'Unnormalized Into: TargetBuy' ;
label _WARN_ = 'Warnings' ;
 
 
******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12;
_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
LENGTH _ARBFMT_1 $      1; DROP _ARBFMT_1;
_ARBFMT_1 = ' '; /* Initialize to avoid warning. */
 
 
_ARBFMT_12 = PUT( TargetBuy , BEST12.);
 %DMNORMCP( _ARBFMT_12, F_TargetBuy );
 
******             ASSIGN OBSERVATION TO NODE             ******;
IF  NOT MISSING(DemAge ) AND
  DemAge  <                 39.5 THEN DO;
  IF  NOT MISSING(DemAffl ) AND
    DemAffl  <                  9.5 THEN DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   14;
      _LEAF_  =                    1;
      P_TargetBuy0  =     0.45839416058394;
      P_TargetBuy1  =     0.54160583941605;
      Q_TargetBuy0  =     0.45839416058394;
      Q_TargetBuy1  =     0.54160583941605;
      V_TargetBuy0  =     0.40431266846361;
      V_TargetBuy1  =     0.59568733153638;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   15;
      _LEAF_  =                    2;
      P_TargetBuy0  =     0.64157706093189;
      P_TargetBuy1  =      0.3584229390681;
      Q_TargetBuy0  =     0.64157706093189;
      Q_TargetBuy1  =      0.3584229390681;
      V_TargetBuy0  =                 0.64;
      V_TargetBuy1  =                 0.36;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE DO;
      _NODE_  =                   16;
      _LEAF_  =                    3;
      P_TargetBuy0  =     0.84615384615384;
      P_TargetBuy1  =     0.15384615384615;
      Q_TargetBuy0  =     0.84615384615384;
      Q_TargetBuy1  =     0.15384615384615;
      V_TargetBuy0  =     0.85483870967741;
      V_TargetBuy1  =     0.14516129032258;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND
                    14.5 <= DemAffl  THEN DO;
    _NODE_  =                    7;
    _LEAF_  =                    6;
    P_TargetBuy0  =     0.05220883534136;
    P_TargetBuy1  =     0.94779116465863;
    Q_TargetBuy0  =     0.05220883534136;
    Q_TargetBuy1  =     0.94779116465863;
    V_TargetBuy0  =     0.05839416058394;
    V_TargetBuy1  =     0.94160583941605;
    I_TargetBuy  = '1' ;
    U_TargetBuy  =                    1;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   17;
      _LEAF_  =                    4;
      P_TargetBuy0  =      0.2125850340136;
      P_TargetBuy1  =     0.78741496598639;
      Q_TargetBuy0  =      0.2125850340136;
      Q_TargetBuy1  =     0.78741496598639;
      V_TargetBuy0  =     0.21518987341772;
      V_TargetBuy1  =     0.78481012658227;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   18;
      _LEAF_  =                    5;
      P_TargetBuy0  =     0.50574712643678;
      P_TargetBuy1  =     0.49425287356321;
      Q_TargetBuy0  =     0.50574712643678;
      Q_TargetBuy1  =     0.49425287356321;
      V_TargetBuy0  =      0.5563909774436;
      V_TargetBuy1  =     0.44360902255639;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  END;
ELSE IF  NOT MISSING(DemAge ) AND
                  44.5 <= DemAge  THEN DO;
  IF  NOT MISSING(DemAffl ) AND
                    10.5 <= DemAffl  AND
    DemAffl  <                 15.5 THEN DO;
    _NODE_  =                   12;
    _LEAF_  =                   13;
    P_TargetBuy0  =     0.73689516129032;
    P_TargetBuy1  =     0.26310483870967;
    Q_TargetBuy0  =     0.73689516129032;
    Q_TargetBuy1  =     0.26310483870967;
    V_TargetBuy0  =     0.71123491179201;
    V_TargetBuy1  =     0.28876508820798;
    I_TargetBuy  = '0' ;
    U_TargetBuy  =                    0;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND
                    15.5 <= DemAffl  THEN DO;
    IF  NOT MISSING(DemAffl ) AND
                      18.5 <= DemAffl  THEN DO;
      _NODE_  =                   33;
      _LEAF_  =                   16;
      P_TargetBuy0  =     0.04166666666666;
      P_TargetBuy1  =     0.95833333333333;
      Q_TargetBuy0  =     0.04166666666666;
      Q_TargetBuy1  =     0.95833333333333;
      V_TargetBuy0  =                 0.08;
      V_TargetBuy1  =                 0.92;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE DO;
      _ARBFMT_1 = PUT( DemGender , $1.);
       %DMNORMIP( _ARBFMT_1);
      IF _ARBFMT_1 IN ('F' ) THEN DO;
        _NODE_  =                   57;
        _LEAF_  =                   14;
        P_TargetBuy0  =     0.29473684210526;
        P_TargetBuy1  =     0.70526315789473;
        Q_TargetBuy0  =     0.29473684210526;
        Q_TargetBuy1  =     0.70526315789473;
        V_TargetBuy0  =     0.31818181818181;
        V_TargetBuy1  =     0.68181818181818;
        I_TargetBuy  = '1' ;
        U_TargetBuy  =                    1;
        END;
      ELSE DO;
        _NODE_  =                   58;
        _LEAF_  =                   15;
        P_TargetBuy0  =      0.5820895522388;
        P_TargetBuy1  =     0.41791044776119;
        Q_TargetBuy0  =      0.5820895522388;
        Q_TargetBuy1  =     0.41791044776119;
        V_TargetBuy0  =     0.78787878787878;
        V_TargetBuy1  =     0.21212121212121;
        I_TargetBuy  = '0' ;
        U_TargetBuy  =                    0;
        END;
      END;
    END;
  ELSE DO;
    _NODE_  =                   11;
    _LEAF_  =                   12;
    P_TargetBuy0  =     0.89773169151004;
    P_TargetBuy1  =     0.10226830848995;
    Q_TargetBuy0  =     0.89773169151004;
    Q_TargetBuy1  =     0.10226830848995;
    V_TargetBuy0  =     0.90019333011116;
    V_TargetBuy1  =     0.09980666988883;
    I_TargetBuy  = '0' ;
    U_TargetBuy  =                    0;
    END;
  END;
ELSE DO;
  IF  NOT MISSING(DemAffl ) AND
    DemAffl  <                  9.5 THEN DO;
    _NODE_  =                    8;
    _LEAF_  =                    7;
    P_TargetBuy0  =     0.76952236542835;
    P_TargetBuy1  =     0.23047763457164;
    Q_TargetBuy0  =     0.76952236542835;
    Q_TargetBuy1  =     0.23047763457164;
    V_TargetBuy0  =     0.76997245179063;
    V_TargetBuy1  =     0.23002754820936;
    I_TargetBuy  = '0' ;
    U_TargetBuy  =                    0;
    END;
  ELSE IF  NOT MISSING(DemAffl ) AND
                    14.5 <= DemAffl  THEN DO;
    _NODE_  =                   10;
    _LEAF_  =                   11;
    P_TargetBuy0  =     0.21804511278195;
    P_TargetBuy1  =     0.78195488721804;
    Q_TargetBuy0  =     0.21804511278195;
    Q_TargetBuy1  =     0.78195488721804;
    V_TargetBuy0  =      0.1917808219178;
    V_TargetBuy1  =     0.80821917808219;
    I_TargetBuy  = '1' ;
    U_TargetBuy  =                    1;
    END;
  ELSE DO;
    _ARBFMT_1 = PUT( DemGender , $1.);
     %DMNORMIP( _ARBFMT_1);
    IF _ARBFMT_1 IN ('F' ) THEN DO;
      _NODE_  =                   23;
      _LEAF_  =                    8;
      P_TargetBuy0  =     0.42231075697211;
      P_TargetBuy1  =     0.57768924302788;
      Q_TargetBuy0  =     0.42231075697211;
      Q_TargetBuy1  =     0.57768924302788;
      V_TargetBuy0  =                  0.4;
      V_TargetBuy1  =                  0.6;
      I_TargetBuy  = '1' ;
      U_TargetBuy  =                    1;
      END;
    ELSE IF _ARBFMT_1 IN ('M' ) THEN DO;
      _NODE_  =                   24;
      _LEAF_  =                    9;
      P_TargetBuy0  =     0.64150943396226;
      P_TargetBuy1  =     0.35849056603773;
      Q_TargetBuy0  =     0.64150943396226;
      Q_TargetBuy1  =     0.35849056603773;
      V_TargetBuy0  =     0.73228346456692;
      V_TargetBuy1  =     0.26771653543307;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    ELSE DO;
      _NODE_  =                   25;
      _LEAF_  =                   10;
      P_TargetBuy0  =      0.8015873015873;
      P_TargetBuy1  =     0.19841269841269;
      Q_TargetBuy0  =      0.8015873015873;
      Q_TargetBuy1  =     0.19841269841269;
      V_TargetBuy0  =     0.86486486486486;
      V_TargetBuy1  =     0.13513513513513;
      I_TargetBuy  = '0' ;
      U_TargetBuy  =                    0;
      END;
    END;
  END;
 
*****  RESIDUALS R_ *************;
IF  F_TargetBuy  NE '0'
AND F_TargetBuy  NE '1'  THEN DO;
        R_TargetBuy0  = .;
        R_TargetBuy1  = .;
 END;
 ELSE DO;
       R_TargetBuy0  =  -P_TargetBuy0 ;
       R_TargetBuy1  =  -P_TargetBuy1 ;
       SELECT( F_TargetBuy  );
          WHEN( '0'  ) R_TargetBuy0  = R_TargetBuy0  +1;
          WHEN( '1'  ) R_TargetBuy1  = R_TargetBuy1  +1;
       END;
 END;
 
****************************************************************;
******          END OF DECISION TREE SCORING CODE         ******;
****************************************************************;
 
drop _LEAF_;
